<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Query 응용</title>
    <script src="fx.js"></script>
</head>
<body>
    <script>
        const obj1 = {
            a: 1,
            b: undefined,
            c: 'CC', 
            d: 'DD'
        };
        function query1(obj) {
            let res = '';
            for (const k in obj) {
                const v = obj[k];
                if (v === undefined)
                    continue;
                console.log(k + ' = ' + v);
                if (res != '')
                    res += '&';
                res += k + '=' + v;
            }
            return res;
        }
        console.log(query1(obj1));
    </script>
    <h2>Reduce로 처리하기</h2>
    <script>
        console.log('-----------Reduce로 처리하기-----------');
            function query2(obj) {
            return Object
            .entries(obj)
            .reduce((query, [k, v], i) => {
                if (v === undefined)
                    return query;
                // return query + (i > 0 ? ' & ' : '') + k + ' = ' + v;
                return `${query}${i > 0 ? ' & ' : ''}${k} = ${v}`;
            }, '');
        }
        console.log(query2(obj1));
    </script>
    <hr>
    <h2>Reject 사용하기</h2>
    <script>
        console.log('-----------Reject 사용하기------------');
        // function query3(obj) {
        //     const format = (a, b) => `${a} & ${b}`;
        //     return (
        //         _.reduce(format,
        //             _.map(([k, v]) => `${k} = ${v}`,
        //             _.reject(([_, v]) => v === undefined,
        //             Object.entries(obj)))
        //         )
        //     );
        // }
        const join = ((sep, iter) =>
            _.reduce((a, b) => `${a} ${sep} ${b}`, iter));

        const query3 = obj =>
            join('&',
                _.map(([k, v]) => `${k} = ${v}`,
                _.reject(([_, v]) => v === undefined,
                    Object.entries(obj)))
                );
        console.log(query3(obj1));
    </script>
    <hr>
    <h2> 지연 처리하기</h2>
    <script>
        console.log('-----------지연 처리하기------------');
        const join2 = sep => iter =>
            _.reduce((a, b) => `${a} ${sep} ${b}`, iter);

        const query4 = _.pipe(
            Object.entries,
            L.reject(([_, v]) => v === undefined),
            L.map(join2('=')),  // 이 경우 join이 커링 지원되는 함수여야 함
            join2('&')
        );
        console.log(query4(obj1));
    </script>
</body>
</html>